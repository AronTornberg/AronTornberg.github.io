

<!DOCTYPE HTML>

<html>

<head>

<meta charset="UTF-8"/>

<title>Grattis Anna!</title>

<style>

* { margin:0; padding:0; } /* to remove the top and left whitespace */



html, body { width:100%; height:100%; overflow: hidden;} /* just to be sure these are full screen*/



canvas { display:block; } /* To remove the scrollbars */





/* to show the canvas bounds */

canvas {

    background: #000;

}



div {

    position: absolute;

    top: 20px;

    left: 20px;

    width: 100%;

    text-align: center;



    font-family: 'Comic Sans MS';

}





h1{

    font-size: 50px;

    color: yellow;

}

h2{

	color: red;

	font-size: 20px;

}

</style>

</head>

<body>

<div id="clock"><h1 id="grattis">Grattis Anna!</h1><h2 id="counter">Här har du en tårta!</h2></div>

<canvas id="canvas"></canvas>

<script>



//create canvas

canvas = document.getElementById("canvas");

counter = document.getElementById("counter");

grattis = document.getElementById("grattis");

ctx = canvas.getContext("2d");



//Load function

loadCounter = 0;

loaded = false;

function incrementLoad(){

    loadCounter++;

    if(loadCounter == 4){

        loaded = true;

    }

} 



bgcolor2 = "#ff0000";

bgcolor3 = "#ffff00";



//Create Anna

anna_width = 220;

anna_height = 299;

eyes_offset_x = 0;

eyes_offset_y = 0;

jaw_offset_y = 0;



anna_x = canvas.width/2 - anna_width/2;

anna_y = canvas.height/2 - anna_height/2;

rect = canvas.getBoundingClientRect();

global_anna_x = rect.left + canvas.width/2;

global_anna_y = rect.top + canvas.height/2 + 20;



jaw_img = new Image();

jaw_img.src = "anna_jaw.png";

jaw_img.onload = incrementLoad;



head_img = new Image();

head_img.src = "anna_head.png";

head_img.onload = incrementLoad;



eyes_img = new Image();

eyes_img.src = "anna_eyes.png";

eyes_img.onload = incrementLoad;



//Create cake

cake_img = new Image();

cake_img.src = "cake.png";

cake_img.onload =incrementLoad;

cake_counter = 1;



cake_height = 112;

cake_width = 100;



cake_x = canvas.width/2 + cake_img.width/2;

cake_y = anna_y;



function placeCake()

{

	cake_x_org = Math.floor(Math.random()*(canvas.width-cake_width));

	cake_y_org = Math.floor(Math.random()*(canvas.height-cake_height*2)+cake_height);

	cake_x = cake_x_org;

	cake_y = cake_y_org;

}



//drag cake

	got_cake = false;

	document.onmousedown = function() {

		if(_x - cake_x > 0 && _x - cake_x < cake_width && _y - cake_y > 0 && _y - cake_y < cake_height)

		{

			got_cake = true;

			cake_offset_x = _x - cake_x;

			cake_offset_y = _y - cake_y;

		}

	};

	document.onmouseup   = function() {

		got_cake = false;

		if(distance_to_jaw < 60)

		{

			placeCake();

			cake_counter++;

			var audio = document.getElementById("eatingsound");



			if(cake_counter == 2)

			{

				counter.innerHTML = "Här har du en till!"

			}

			else if(cake_counter == 11)

			{

				counter.innerHTML = "Mmmh!";

			}

			else if(cake_counter == 21)

			{

				counter.innerHTML = "Så jävla gott!";

			}

			else if(cake_counter == 31)

			{

				grattis.innerHTML = "ÄT! ÄT! ÄT!";

				counter.innerHTML = "Låt inte tårtan fly!!";

			}

			else if(cake_counter == 41)

			{

				counter.innerHTML = "ORGASMISKT!";

			}

			else if(cake_counter == 51)

			{

				grattis.innerHTML = "EUFORISKT!";

				counter.innerHTML = "ATT DU ORKAR!";

			}

			else if(cake_counter == 61)

			{

				grattis.innerHTML = "DU VINNER!";

				counter.innerHTML = ":)";

			}

			else

			{

				counter.innerHTML = "Här har du en " + cake_counter.toString();



				if(cake_counter%10 >= 1 && cake_counter%10 <= 2 && Math.floor(cake_counter/10)%10 != 1)

				{

					counter.innerHTML += ":a";

				}

				else

				{

					counter.innerHTML += ":e";

				}

			}

			audio.play();



		}

	};



	//Get mouseposition

	(function() {

		window.onmousemove = handleMouseMove;

		function handleMouseMove(event) {

			event = event || window.event; // IE-ism

			// event.clientX and event.clientY contain the mouse position

			_x = event.clientX;

			_y = event.clientY;

			if(got_cake)

			{

				cake_x = _x - cake_offset_x;

				cake_y = _y - cake_offset_y;

				cake_x_org = cake_x;

				cake_y_org = cake_y;

			}

		}

	})();

//Game loop

grattis.style.fontSize = "80px";

counter.style.fontSize = "30px";

notdone1 = true;

fontswitch = Date.now();

annashake = 1;

end = false;

hej = 0;

var render = function(){

	bgcolor ="#000000";

	if(Date.now() - then > 11000 && cake_counter == 1)

	{

		document.getElementById('music').currentTime = 0;

		counter.innerHTML = "Stoppa tårtan i munnen kanske!";

		then = Date.now();

		if(hej == 1)

		{

			counter.innerHTML = "Klicka på och dra tårtan till munnen!";

		}

		else if(hej == 2)

		{

			counter.innerHTML = "Ring 073-6746506 så kan Aron förklara hur det fungerar.";

			hej = 0;

		}

		hej++;

	}

	if(Date.now() - then > 12500 && cake_counter > 10)

	{

		if(Date.now()%300 < 100)

		{

			bgcolor = bgcolor2;

		}

		else if(Date.now()%300 < 200)

		{

			bgcolor = bgcolor3;

		}

	if(cake_counter > 20)

	{	

		if(Date.now() - fontswitch > 100)

		{

			temp = grattis.style.fontSize;

			grattis.style.fontSize = counter.style.fontSize;

			counter.style.fontSize = temp;

			fontswitch = Date.now();

		}

	if(cake_counter > 30)

	{	

		if(!got_cake)

		{

			cake_x = cake_x_org + Math.round(Math.cos(0.1*Date.now()/cake_counter)*cake_counter*5);

			cake_y = cake_y_org + Math.round(Math.sin(0.1*Date.now()/cake_counter)*cake_counter*5);

		}

	if(cake_counter > 40)

	{

		annashake = 10;

	if(cake_counter > 50)

	{

		cake_x += (Math.random()-0.5)*Math.pow(cake_counter,2.0)/30;

		cake_y += (Math.random()-0.5)*Math.pow(cake_counter,2.0)/30;

	if(cake_counter > 60)

	{

		cake_x += (Math.random()-0.5)*Math.pow(cake_counter,2.0)/30;

		cake_y += (Math.random()-0.5)*Math.pow(cake_counter,2.0)/30;

		annashake = 100;

	if(cake_counter > 70)

	{

	if(cake_counter > 80)

	{

	if(cake_counter > 90)

	{

	if(cake_counter > 100)

	{

		

	}	

	}	

	}	

	}	

	}	

	}	

	}	

	}

	}

	}



	ctx.fillStyle = bgcolor;

	ctx.fillRect(0, 0, canvas.width, canvas.height);

	if(loaded)

	{

		anna_x = anna_x_org + annashake*(Math.random()-0.5)*Math.pow(cake_counter,1.6)/30;

		anna_y = anna_y_org + annashake*(Math.random()-0.5)*Math.pow(cake_counter,1.6)/30;

		global_anna_x = anna_x + anna_width/2;

		global_anna_y = anna_y + anna_height/2 + 20;



		eyes_offset_x = (cake_x+cake_width/2 - global_anna_x)/100;

		eyes_offset_y = (cake_y+cake_height/2- global_anna_y+80)/30;

		if(eyes_offset_x > 15)

			eyes_offset_x  = 15;

		else if(eyes_offset_x  < -15)

			eyes_offset_x = -15;





		if(eyes_offset_y > 10)

			eyes_offset_y  = 10;

		else if(eyes_offset_y  < -5)

			eyes_offset_y = -5;



		distance_to_jaw = Math.sqrt( (cake_x+cake_width/2 - global_anna_x)*(cake_x+cake_width/2 - global_anna_x)+(cake_y+cake_height/2 - global_anna_y-80)*(cake_y+cake_height/2 - global_anna_y-80) );

		jaw_offset_y = 1000/distance_to_jaw;

		if(jaw_offset_y > 40)

			jaw_offset_y = 40;



		ctx.drawImage(eyes_img, anna_x+eyes_offset_x , anna_y+eyes_offset_y );

		ctx.drawImage(head_img, anna_x, anna_y);

		ctx.drawImage(jaw_img, anna_x, anna_y+jaw_offset_y );

		ctx.drawImage(cake_img, cake_x, cake_y);



	}

	else if(end)

	{

		end = false;



	}

}

//Run game

var then = Date.now();

setInterval(render, 1);





//resize window

(function() {

        canvas = document.getElementById('canvas'),

                context = canvas.getContext('2d');



        // resize the canvas to fill browser window dynamically

        window.addEventListener('resize', resizeCanvas, false);

        

        function resizeCanvas() {

                canvas.width = window.innerWidth;

                canvas.height = window.innerHeight;

                anna_x_org = canvas.width/2 - anna_width/2;

				anna_y_org = canvas.height/2 - anna_height/2;

				anna_x = anna_x_org;

				anna_y = anna_y_org;

				rect = canvas.getBoundingClientRect();

				global_anna_x = rect.left + canvas.width/2;

				global_anna_y = rect.top + canvas.height/2 + 20;

				cake_x_org = canvas.width/2 - cake_width/2+5;

				cake_y_org = anna_y-65;

				cake_x = cake_x_org;

				cake_y = cake_y_org;

                

                /**

                 * Your drawings need to be inside this function otherwise they will be reset when 

                 * you resize the browser window and the canvas goes will be cleared.

                 */

                render(); 

        }

        resizeCanvas();

})();





</script>

<audio id="music" autoplay="autoplay" hidden="hidden" loop="loop">

<source src="birthday.ogg" type="audio/ogg"/>

</audio>

<audio id="eatingsound"><source src="eating.ogg"></source></audio>

</body>

</html>